---
title: 'Electron에서 MQTT로 IoT 제어하기: AWS IoT Core 연동 가이드'
date: '2025-03-06'
updatedDate: ''
image: ''
excerpt: ''
tag: 'AWS'
---

### **개요**

오늘은 Electron.js 의 메인 프로세스에서 AWS IoT Core 를 연동하고, Mqtt 프로토콜을 활용하는 방식에 대해서 알아보고자 한다.

일렉트론의 메인 프로세스는 사실상 일반적인 node.js 이기 때문에, node.js 에 AWS IoT Core 를 적용 + 전송받은 데이터를 어떻게 화면에 뿌려줄 수 있을지에 대한 내용까지 포괄적으로 다루는 글이 될 것 같다.

### **계기**

무인 키오스크 프로그램의 개발을 맡게 되었는데, 이 때 기기와 서버간에 실시간 통신을 위한 프로토콜로 MQTT를 채택하게 되었다.
기존에는 일반적인 rest api 방식으로 통신을 했는데, 라우터의 용량 등 비용적인 한계가 있어 비교적 경량화 된 프로토콜이 필요했다.

또 Aws 에서 제공하는 IoT Core 라는 서비스를 통해 기기 현황, 연결 상태 등을 체크할 수 있어서 여기서 제공하는 SDK 를 활용해 개발을 하게 되었고, 이 때 경험한 여러 삽질과 알게된 점을 정리해 공유하고자 한다.

### **Why MQTT?**

**MQTT란 무엇인가**

**Message Queueing Telemetry Transport** 의 약자로, 간단히 말하자면 통신 프로토콜이다. Http 같은..

경량화된 프로토콜로 메시지 크기가 작고 오버헤드가 적어 네트워크 대역폭을 최소화한다. 그래서 배터리 소모가 적어 저전력 IoT 기기에 적합하다.
TCP/IP 를 기반으로 동작하기 때문에 항상 연결을 유지할 수 있고, 실시간 양방향 통신을 가능하게 한다. WebSocket 을 지원해서 브라우저에서도 활용할 수 있음.

구독-발행 모델로 브로커를 통해서 메시지를 중개하는 방식인데, 우리는 뒤에서 살펴볼 AWS 의 IoT Core 서비스를 활용할 것이다.

### **Why AWS IoT Core??**

AWS IoT Core 에 등록된 기기 간 Mqtt 통신 연결을 지원하고, AWS 의 IoT 클라우드 서비스를 제공해준다. IoT Core 에 사물을 등록하면 해당 사물에 대한 연결 상태 및 명령 전송 등 플랫폼에서 할 수 있는 기능들을 추가로 제공해준다.

기기 입장에서 유용하게 사용한건 테스트 클라이언트와, id 값으로 서버에서 온라인 상태인지 확인하는 여부 등.. 우리 서비스는 자체 모니터링 어드민도 함께 개발되었기 때문에 AWS 클라우드에서 제공하는 기능을 전부 다 활용하지는 않을 것 같다는게 나의 생각.

다른 대안으로는 [mosquitto](https://mosquitto.org/)가 있다. 무료 오픈소스 라이브러리이기 때문에 (사용은 안해봤으나) 굳이 AWS 에서 제공하는 다양한 기능을 활용하지 않아도 된다면 오히려 이쪽이 더 간편할 수도...

### **Electron과의 연동 시나리오**

이 글은 한 대의 IoT 기기가 API 서버와 Mqtt 프로토콜을 이용해 실시간, 양방향 통신을 한다는 것을 전제로 한다.

API 서버라고 해서 별도의 셋팅이 필요한 것이 아니고, MQTT 브로커의 입장에서 보면 서버 또한 하나의 기기이기 때문에 큰 그림으로 보면 A 기기와 B 기기 간 메시지를 브로드캐스팅 하는 방식이라고 이해하면 좋을 것 같다.

그래서 다음과 같은 흐름으로 통신을 연결하고 메시지를 주고받게 된다.

1. 각 기기에서 aws sdk 를 활용해 Mqtt 통신을 위한 초기화를 하고 연결을 준비한다.
2. 응답을 받을 토픽을 구독한다.
3. 특정 토픽으로 요청을 발행한다.

Mqtt 통신 시에는 이렇게 요청하는 채널과 응답을 받는 채널이 나뉘어 있는데, 나의 경우 특정한 데이터를 요청하는 경우가 많아 반드시 요청에 해당하는 응답을 찾아 활용해야 하는 경우가 대부분이었음. 그래서 세션 id 와 Promise 객체를 활용하는 방식으로 핸들러를 만들어 요청-응답 모델처럼 활용을 했다. 그런데 이 방법이 100% 좋은지는 확실치 않아서 그냥 이런 경우도 있다는 참고용으로 예제를 추가해보려고 한다.

### **AWS IoT Core 설정**

일단 통신을 연결하기 위해서는 iot core 에 등록된 사물이 있어야 하기 때문에,
[AWS IoT Core](https://ap-northeast-2.console.aws.amazon.com/iot/home?region=ap-northeast-2#/home)
콘솔에 로그인하여 사물을 생성하는 것 부터 시작한다.

Thing 생성
보안 인증서 발급 및 정책 설정
MQTT 테스트 클라이언트에서 메시지 송수신 확인

### **Electron 에서 초기화**

AWS SDK 설치 및 환경 구성
MQTT 클라이언트 설정 (aws-iot-device-sdk-v2)
AWS IoT Core와의 연결 코드 구현

### **실제로 메시지를 주고받아 봅시다!**

메인 프로세스에서 Publish/Subscribe 구현
AWS IoT Core에서 수신한 메시지를 처리하는 방법
QoS 옵션을 활용한 신뢰성 있는 데이터 송수신
테스트 및 디버깅 (연결 상태 확인, 로그 분석 등)

### **Bonus, 렌더러 프로세스와의 통신!**

메인 프로세스에서 수신한 MQTT 메시지를 렌더러로 전달 (ipcMain, ipcRenderer)
UI에서 실시간 데이터 반영하기 (예: 기기의 현재 상태 표시)
렌더러에서 사용자 입력을 받아 MQTT로 서버에 명령 전송하기
